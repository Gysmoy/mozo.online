USE MASTER
GO

IF DB_ID('MUEBLERIA') IS NOT NULL
	DROP DATABASE MUEBLERIA
GO

CREATE DATABASE MUEBLERIA
GO

USE MUEBLERIA
GO

CREATE TABLE SOCIEDAD_COMERCIAL
(	IdSociedad			CHAR(8) NOT NULL,
	SociedadComercial	VARCHAR(50) NOT NULL,
	Siglas				VARCHAR(8) NOT NULL,
	CONSTRAINT sociedad_pk PRIMARY KEY (IdSociedad),
	CONSTRAINT sociedad_uk UNIQUE (SociedadComercial),
	CONSTRAINT siglas_uk UNIQUE (Siglas)
)
GO

CREATE TABLE EMPRESA
(	IdEmpresa		CHAR(8) NOT NULL,
	RazonSocial		VARCHAR(60) NOT NULL,
	IdSociedad		CHAR(8) NULL,
	RUC				CHAR(11) NOT NULL,
	Direccion		VARCHAR(100) NULL,
	CONSTRAINT empresa_pk PRIMARY KEY (IdEmpresa),
	CONSTRAINT razon_uk UNIQUE (RazonSocial),
	CONSTRAINT idsociedad_fk FOREIGN KEY (IdSociedad) REFERENCES SOCIEDAD_COMERCIAL(IdSociedad),
	CONSTRAINT ruc_ck CHECK (RUC LIKE('[1-2][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'))		
)
GO

CREATE TABLE PERSONA
(	IdPersona	CHAR(8) NOT NULL,
	ApePat		VARCHAR(20) NOT NULL,
	ApeMat		VARCHAR(20) NOT NULL,
	Nombres		VARCHAR(30) NOT NULL,
	Sexo		CHAR(1) NOT NULL,
	FechaNac	DATE NULL,
	DNI			CHAR(8) NOT NULL,
	Direccion	VARCHAR(100) NULL,
	CONSTRAINT persona_pk PRIMARY KEY(IdPersona),
	CONSTRAINT dni_uk UNIQUE (DNI),
	CONSTRAINT dni_ck CHECK (DNI LIKE('[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]')),
	CONSTRAINT sexo_ck CHECK (Sexo IN ('M','F')),
	CONSTRAINT fechanac_ck CHECK (FechaNac < getdate())
)
GO

CREATE TABLE CLIENTE
(	IdCliente		CHAR(8) NOT NULL,
	Tipo			CHAR(1) NOT NULL,
	IdPersona		CHAR(8) NULL,
	IdEmpresa		CHAR(8) NULL,
	CONSTRAINT idcliente_pk PRIMARY KEY (IdCliente),
	CONSTRAINT tipo_ck CHECK (Tipo IN ('N','J')),
	CONSTRAINT idpersona_fk FOREIGN KEY (IdPersona) REFERENCES PERSONA(IdPersona),
	CONSTRAINT idempresa_fk FOREIGN KEY (IdEmpresa) REFERENCES EMPRESA(IdEmpresa),
)
GO

CREATE TABLE VENTA
(	IdVenta				CHAR(8) NOT NULL,
	Fecha				DATE NOT NULL,
	IdCliente			CHAR(8) NOT NULL,
	TipoComprobante		CHAR(1) NOT NULL,
	SerieComprobante	CHAR(4) NOT NULL,
	NumComprobante		CHAR(8) NOT NULL,
	CONSTRAINT venta_pk PRIMARY KEY (IdVenta),
	CONSTRAINT cliente_fk FOREIGN KEY (IdCliente) REFERENCES CLIENTE(IdCliente),
	CONSTRAINT tipocomp_ck CHECK (TipoComprobante IN ('B','F')),
	CONSTRAINT comprobante_uk UNIQUE(TipoComprobante,SerieComprobante,NumComprobante)
)
GO

--INSERCIONES A LA TABLA SOCIEDAD_COMERCIAL
INSERT INTO SOCIEDAD_COMERCIAL VALUES ('SOC00001','SOCIEDAD ANÓNIMA','S.A.')
INSERT INTO SOCIEDAD_COMERCIAL VALUES ('SOC00002','SOCIEDAD ANÓNIMA ABIERTA','S.A.A.')
INSERT INTO SOCIEDAD_COMERCIAL VALUES ('SOC00003','SOCIEDAD ANÓNIMA CERRADA','S.A.C.')
INSERT INTO SOCIEDAD_COMERCIAL VALUES ('SOC00004','SOCIEDAD DE RESPONSABILIDAD LIMITADA','S.R.L.')
INSERT INTO SOCIEDAD_COMERCIAL VALUES ('SOC00005','SOCIEDAD DE RESPONSABILIDAD ILIMITADA','S.R.I.')
--INSERCIONES A LA TABLA EMPRESA
INSERT INTO EMPRESA VALUES ('EMP00001','COMERCIAL ROJITAS','SOC00001','20456734244',NULL)
INSERT INTO EMPRESA VALUES ('EMP00002','POLLERÍA POLLITO CON PAPAS','SOC00004','20345789002','PSJ. LOS JAZMINES #325')
INSERT INTO EMPRESA VALUES ('EMP00003','AVICOLA POLLO GORDO','SOC00004','20114783675','AV. LOS MARTIRES #267')
INSERT INTO EMPRESA VALUES ('EMP00004','FERRETERÍA MENDEZ','SOC00003','20674523143',NULL)
INSERT INTO EMPRESA VALUES ('EMP00005','LIBRERÍA LOS MAESTROS','SOC00001','20683148645','JR. LAMPA CUADRA 5 # 548')
GO
--INSERCIONES A LA TABLA PERSONA
INSERT INTO PERSONA VALUES ('PER00001','MEZA','FUJIMORI','KEIKO MARÍA','F','1992-04-16','76341945',NULL)
INSERT INTO PERSONA VALUES ('PER00002','BASADULA','BRUN','OSCAR','M','2000-08-23','79124567','AV. GRAU #356')
INSERT INTO PERSONA VALUES ('PER00003','LINARES','BENAVIDES','YONATAN','M',NULL,'73458522',NULL)
INSERT INTO PERSONA VALUES ('PER00004','INOSTROZA','BASALDUA','JUAN EMILIO','M','2001-08-27','77123242','PSJE. TOLEDO #124')
INSERT INTO PERSONA VALUES ('PER00005','MORENO','ASCAMA','BRIGITE','F','1997-06-24','65342644',NULL)
INSERT INTO PERSONA VALUES ('PER00006','HUACHIN','QUISPE','MARIO','M','1994-02-13','75134896','CALLE OSCAR R. BENAVIDES 476')
INSERT INTO PERSONA VALUES ('PER00007','GUTIERREZ','LIMAY','CINTHIA','F','2000-09-22','11111111',NULL)
INSERT INTO PERSONA VALUES ('PER00008','NAJARRO','QUISPE','TEMPLETON','M','1998-04-05','22222222','PASAJE RIVAS 325')
INSERT INTO PERSONA VALUES ('PER00009','CASSANI','HERNANDEZ','ESMERALDA','F','1982-04-13','33333333','URBANIZACION ROSEDAL 3º ETAPA LOTE 16')
INSERT INTO PERSONA VALUES ('PER00010','VARGAS','ACASIETE','ANIBAL','M','2001-12-25','44444444',NULL)
INSERT INTO PERSONA VALUES ('PER00011','QUISPE','SOTO','RUTH','F','1997-07-17','55555555','PASAJE RIVAS 125')
INSERT INTO PERSONA VALUES ('PER00012','VARA','BENAVIDES','MURDOCK','M','1985-05-16','66666666',NULL)

--INSERCIONES A LA TABLA CLIENTE
INSERT INTO CLIENTE VALUES ('CLI00001','N','PER00001',NULL)
INSERT INTO CLIENTE VALUES ('CLI00002','N','PER00002',NULL)
INSERT INTO CLIENTE VALUES ('CLI00003','J',NULL,'EMP00001')
INSERT INTO CLIENTE VALUES ('CLI00004','J',NULL,'EMP00002')
INSERT INTO CLIENTE VALUES ('CLI00005','N','PER00003',NULL)
INSERT INTO CLIENTE VALUES ('CLI00006','J',NULL,'EMP00003')
INSERT INTO CLIENTE VALUES ('CLI00007','J',NULL,'EMP00004')
INSERT INTO CLIENTE VALUES ('CLI00008','N','PER00004',NULL)
INSERT INTO CLIENTE VALUES ('CLI00009','N','PER00005',NULL)
INSERT INTO CLIENTE VALUES ('CLI00010','J',NULL,'EMP00005')
GO

INSERT INTO VENTA VALUES ('VEN00001','2017-08-02','CLI00003','F','0001','00000045')
INSERT INTO VENTA VALUES ('VEN00002','2017-08-02','CLI00006','F','0001','00000046')
INSERT INTO VENTA VALUES ('VEN00003','2017-08-03','CLI00001','B','0001','00000030')
INSERT INTO VENTA VALUES ('VEN00004','2017-08-03','CLI00004','F','0001','00000047')
INSERT INTO VENTA VALUES ('VEN00005','2017-08-04','CLI00003','F','0001','00000048')
INSERT INTO VENTA VALUES ('VEN00006','2017-08-05','CLI00006','B','0001','00000031')
INSERT INTO VENTA VALUES ('VEN00007','2017-08-05','CLI00003','F','0001','00000049')
INSERT INTO VENTA VALUES ('VEN00008','2017-08-07','CLI00010','F','0001','00000050')
INSERT INTO VENTA VALUES ('VEN00009','2017-08-10','CLI00005','F','0001','00000051')
INSERT INTO VENTA VALUES ('VEN00010','2017-08-10','CLI00008','B','0001','00000032')
INSERT INTO VENTA VALUES ('VEN00011','2017-08-11','CLI00003','B','0001','00000033')
INSERT INTO VENTA VALUES ('VEN00012','2017-08-14','CLI00008','F','0001','00000052')
INSERT INTO VENTA VALUES ('VEN00013','2017-08-16','CLI00003','F','0001','00000053')
INSERT INTO VENTA VALUES ('VEN00014','2017-08-16','CLI00004','F','0001','00000054')
GO
SELECT *FROM EMPRESA

--MOSTRAR LOS CLIENTES QUE NO TIENEN DIRECCIÓN
SELECT CLI.* FROM CLIENTE INNER
JOIN PERSONA PER ON PER.IdPersona = CLI.IdPersona
JOIN EMPRESA EMP ON EMP.IdEmpresa = CLI.IdEmpresa
WHERE PER.Direccion = NULL OR EMP.Direccion = NULL

--MOSTRAR LOS CLIENTES QUE NO TIENEN FECHA DE NACIMIENTO

--MOSTRAR LAS EMPRESAS QUE SON SOCIEDAD ANÓNIMA

--MOSTRAR EL CLIENTE PERSONA QUE HA ESTADO EN MÁS VENTAS